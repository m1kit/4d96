"use strict";var _createClass=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(){var i=void 0,n=void 0,v={INVALID:0,EMPTY:1,RED:2,GREEN:3,BLUE:4},d={UPPER_LEFT:0,LOWER_RIGHT:1,LEFT:2,RIGHT:3,LOWER_LEFT:4,UPPER_RIGHT:5},l=[[null,null,null,v.GREEN,v.BLUE,v.EMPTY,v.BLUE,v.RED],[null,v.GREEN,v.EMPTY,v.EMPTY,v.EMPTY,v.EMPTY,v.EMPTY,v.RED],[v.RED,v.EMPTY,v.EMPTY,v.EMPTY,v.EMPTY,v.EMPTY,v.GREEN,null],[v.RED,v.BLUE,v.EMPTY,v.BLUE,v.GREEN,null,null,null]],a=function(){function h(a){var s=this;_classCallCheck(this,h);var o=document.getElementById("board-shape");o.innerHTML="",document.getElementById("board").setAttribute("viewBox","0 "+a+" "+2*a*Math.sqrt(3)+" "+4*a),this.size=a,this.data=new Array(2*a);for(var t=function(c){s.data[c]=new Array(4*a);for(var t=function(u){var t=2*c+u;if(t<2*a-1||6*a-2<t)return s.data[c][u]=v.INVALID,"continue";s.data[c][u]=v.EMPTY;var e=2*c+Math.floor(u/2),r=Math.floor(u/2)*Math.sqrt(3),n=Math.floor(u/2+1)*Math.sqrt(3);o.insertAdjacentHTML("beforeend",'<polygon id="'+c+"-"+u+'" points="'+n+","+(e+1)+" "+r+","+(e+2)+" "+(u%2==0?r+" "+e:n+" "+(e+3))+'" stroke-width=".025"></polygon>'),f(u,c).addEventListener("mouseenter",function(){var t=void 0;switch(y()){case v.RED:t="#ff8494";break;case v.GREEN:t="#68e4bb";break;case v.BLUE:t="#6e92dd";break;default:throw new Error}var e=s.getReplacables(u,c,y()),r=!0,n=!1,a=void 0;try{for(var o,i=e[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var l=o.value;E.apply(void 0,_toConsumableArray(l).concat([t]))}}catch(t){n=!0,a=t}finally{try{!r&&i.return&&i.return()}finally{if(n)throw a}}},!1),f(u,c).addEventListener("mouseleave",function(){b()},!1)},e=0;e<s.data[c].length;e++)t(e)},e=0;e<this.data.length;e++)t(e);for(var r=0;r<l.length;r++)for(var n=0;n<l[r].length;n++)l[r][n]&&this.putForcibly(n+2*(a-2),r+(a-2),l[r][n])}return _createClass(h,[{key:"getReplacables",value:function(t,e,r){if(this.at(t,e)===v.EMPTY){var n=this.getAvailableDirections(t,e,r);if(0===n.length)return[];var a=[[t,e]],o=!0,i=!1,l=void 0;try{t:for(var u,c=n[Symbol.iterator]();!(o=(u=c.next()).done);o=!0)for(var s=u.value,f=[t,e];;){if(f=h.next(f[0],f[1],s),this.at(f[0],f[1])===r)continue t;a.push([f[0],f[1]])}}catch(t){i=!0,l=t}finally{try{!o&&c.return&&c.return()}finally{if(i)throw l}}return a}return[]}},{key:"put",value:function(t,e,r){var n=this.getReplacables(t,e,r);if(0===n.length)return!1;var a=!0,o=!1,i=void 0;try{for(var l,u=n[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=l.value;this.putForcibly.apply(this,_toConsumableArray(c).concat([r]))}}catch(t){o=!0,i=t}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}return!0}},{key:"putForcibly",value:function(t,e,r){this.data[e][t]=r}},{key:"at",value:function(t,e){return t<0||e<0||t>=4*this.size||e>=2*this.size?v.INVALID:this.data[e][t]}},{key:"getAvailableDirections",value:function(t,e,r){if(this.at(t,e)!==v.EMPTY)return[];var n=[],a=!0,o=!1,i=void 0;try{t:for(var l,u=Object.values(d)[Symbol.iterator]();!(a=(l=u.next()).done);a=!0)for(var c=l.value,s=[t,e],f=!1;;){s=h.next(s[0],s[1],c);var E=this.at.apply(this,_toConsumableArray(s));if(E===r){f&&n.push(c);continue t}if(E===v.EMPTY||E===v.INVALID)continue t;f=!0}}catch(t){o=!0,i=t}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}return n}},{key:"isAvailable",value:function(t,e,r){return 0<this.getAvailableDirections(t,e,r).length}},{key:"getAvailables",value:function(t){for(var e=[],r=0;r<this.data.length;r++)for(var n=0;n<this.data[r].length;n++)this.isAvailable(n,r,t)&&e.push([n,r]);return e}},{key:"count",value:function(t){for(var e=0,r=0;r<this.data.length;r++)for(var n=0;n<this.data[r].length;n++)this.at(n,r)===t&&e++;return e}},{key:"getWhoWon",value:function(){var t=this.count(v.RED),e=this.count(v.GREEN),r=this.count(v.BLUE);return e<=t&&r<=t?v.RED:r<=e?v.GREEN:v.BLUE}}],[{key:"next",value:function(t,e,r){switch(r){case d.UPPER_LEFT:return[t+(t%2==0?1:-1),e-(t%2==0?1:0)];case d.LOWER_RIGHT:return[t+(t%2==0?1:-1),e+(t%2==0?0:1)];case d.LEFT:return[t-1,e];case d.RIGHT:return[t+1,e];case d.LOWER_LEFT:return[t-1,e+(t%2==0?0:1)];case d.UPPER_RIGHT:return[t+1,e-(t%2==0?1:0)];default:throw new Error}}}]),h}();function f(t,e){var r=document.getElementById(e+"-"+t);return null===r&&console.log(t+","+e),r}function u(t){switch(t){case v.RED:return document.getElementById("red");case v.GREEN:return document.getElementById("green");case v.BLUE:return document.getElementById("blue");default:throw new Error}}function E(t,e,r){f(t,e).setAttribute("fill",r)}function y(){switch(n%3){case 0:return v.RED;case 1:return v.GREEN;case 2:return v.BLUE;default:throw new Error}}function b(){for(var t=!1,e=0;e<2*i.size;e++)for(var r=0;r<4*i.size;r++)switch(i.at(r,e)){case v.INVALID:continue;case v.EMPTY:0===i.getReplacables(r,e,y()).length?E(r,e,"#adadad"):(E(r,e,"#f8fbf8"),t=!0);break;case v.RED:E(r,e,"#e95464");break;case v.GREEN:E(r,e,"#38b48b");break;case v.BLUE:E(r,e,"#3e62ad");break;default:throw new Error}for(var n=[v.RED,v.GREEN,v.BLUE],a=0;a<n.length;a++){var o=n[a];u(o).innerText=i.count(o),y()===o?u(o).classList.add("player"):u(o).classList.remove("player")}return t}function o(t,e){i.put(t,e,y())&&function t(e){3<=e?(b(),confirm("試合が終了しました。次の試合を開始します。")&&r()):(n++,b()||t(e+1))}(0)}function r(){var t=Math.max(2,parseInt(location.hash.substr(1),10))||4;i=new a(t);for(var e=function(e){for(var t=function(t){i.at(t,e)!==v.INVALID&&(f(t,e).onclick=function(){return o(t,e)})},r=0;r<4*i.size;r++)t(r)},r=n=0;r<2*i.size;r++)e(r);b()}r()}();
//# sourceMappingURL=main.min.js.map
